{"version":3,"sources":["webpack:///./src/views/SettingPage.vue?c0d4","webpack:///./src/views/SettingPage.vue?9ed5","webpack:///src/views/SettingPage.vue","webpack:///./src/views/SettingPage.vue?9707","webpack:///./src/views/SettingPage.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","on","$event","preventDefault","stopPropagation","updateUserInfo","apply","arguments","attrs","formItems","handleOverLength","isProcessing","_v","staticRenderFns","name","components","SettingLayout","BaseInput","BaseButton","data","id","inputName","value","isError","isBlank","prefix","type","isAuthenticated","computed","mapState","created","setUser","methods","e","account","email","password","passwordCheck","form","formData","userAPI","userId","console","toast","component"],"mappings":"kHAAA,W,gECAA,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,iBAAiB,CAACA,EAAG,OAAO,CAACE,YAAY,oBAAoBC,GAAG,CAAC,OAAS,SAASC,GAAyD,OAAjDA,EAAOC,iBAAiBD,EAAOE,kBAAyBV,EAAIW,eAAeC,MAAM,KAAMC,cAAc,CAACT,EAAG,YAAY,CAACE,YAAY,gBAAgBQ,MAAM,CAAC,aAAad,EAAIe,WAAWR,GAAG,CAAC,yBAAyBP,EAAIgB,oBAAoBZ,EAAG,aAAa,CAACE,YAAY,iBAAiBQ,MAAM,CAAC,SAAW,QAAQ,KAAO,SAAS,WAAad,EAAIiB,eAAe,CAACjB,EAAIkB,GAAG,SAAS,MAC7iBC,EAAkB,G,sHC0BP,GACbC,KAAMA,cACNC,WAAYA,CACVC,cAAJA,OACIC,UAAJA,OACIC,WAAJA,QAEEC,KAPF,WAQI,MAAO,CACLV,UAAWA,CACjB,CACQW,GAARA,EACQN,KAARA,KACQO,UAARA,UACQC,MAARA,GACQC,SAARA,EACQC,SAARA,EACQC,OAARA,KAEA,CACQL,GAARA,EACQN,KAARA,KACQO,UAARA,OACQC,MAARA,GACQC,SAARA,GAEA,CACQH,GAARA,EACQN,KAARA,QACQO,UAARA,QACQC,MAARA,GACQC,SAARA,GAEA,CACQH,GAARA,EACQN,KAARA,KACQO,UAARA,WACQK,KAARA,WACQJ,MAARA,GACQC,SAARA,EACQC,SAARA,GAEA,CACQJ,GAARA,EACQN,KAARA,OACQO,UAARA,gBACQK,KAARA,WACQJ,MAARA,GACQC,SAARA,EACQC,SAARA,IAGMG,iBAAiBA,EACjBhB,cAAcA,IAGlBiB,SAAUA,kBACZC,iCAEEC,QA3DF,WA4DInC,KAAKoC,WAEPC,QAASA,CAEPtB,iBAFJ,WAGMf,KAAKc,UAAU,GAAGc,SAAU,GAG9BQ,QANJ,WAOM,KAAN,mBAEM,KAAN,4CACM,KAAN,yCACM,KAAN,2CAGI1B,eAdJ,SAcA4B,GAAA,4LAEA,kBACAb,EAAA,iBACAc,EAAA,eACApB,EAAA,eACAqB,EAAA,eACAC,EAAA,eACAC,EAAA,iBAIAH,kBAZA,wBAaAA,aAbA,2BAiBAA,aAjBA,WAqBAE,kBArBA,wBAsBAA,aACAC,aAvBA,2BA2BAD,aACAC,aA5BA,aAgCAvB,mBAhCA,0DAmCAwB,EAAAL,SACAM,EAAA,gBACAA,oDArCA,UAwCAC,eACAC,SACAF,aA1CA,oBAwCApB,EAxCA,EAwCAA,KAOAA,oBACAA,wCAhDA,wBAkDAuB,uBACAR,aAnDA,8BAsDAf,oBACAA,sCAvDA,wBA0DAuB,uBACAP,aA3DA,2BA+DAQ,2BACA,wBAhEA,6DAmEAD,0BACAC,mCApEA,yBAsEA,kBAtEA,kFCvGqV,I,wBCQjVC,EAAY,eACd,EACAnD,EACAoB,GACA,EACA,KACA,WACA,MAIa,aAAA+B,E","file":"js/chunk-497e8e8c.f3193d6a.js","sourcesContent":["export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SettingPage.vue?vue&type=style&index=0&id=738abde0&lang=scss&scoped=true&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('setting-layout',[_c('form',{staticClass:\"setting-container\",on:{\"submit\":function($event){$event.preventDefault();$event.stopPropagation();return _vm.updateUserInfo.apply(null, arguments)}}},[_c('BaseInput',{staticClass:\"setting-input\",attrs:{\"form-items\":_vm.formItems},on:{\"after-over-name-length\":_vm.handleOverLength}}),_c('BaseButton',{staticClass:\"setting-button\",attrs:{\"position\":'right',\"mode\":'action',\"isDisabled\":_vm.isProcessing}},[_vm._v(\"儲存\")])],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <setting-layout>\n    <form class=\"setting-container\" @submit.prevent.stop=\"updateUserInfo\">\n      <BaseInput\n        class=\"setting-input\"\n        :form-items=\"formItems\"\n        @after-over-name-length=\"handleOverLength\"\n      />\n      <BaseButton\n        class=\"setting-button\"\n        :position=\"'right'\"\n        :mode=\"'action'\"\n        :isDisabled=\"isProcessing\"\n        >儲存</BaseButton\n      >\n    </form>\n  </setting-layout>\n</template>\n\n<script>\nimport SettingLayout from \"../components/layouts/SettingLayout.vue\";\nimport BaseInput from \"../components/UI/BaseInput.vue\";\nimport BaseButton from \"../components/UI/BaseButton.vue\";\nimport userAPI from \"../apis/users\";\nimport { toast } from \"../utils/helper\";\nimport { mapState } from \"vuex\";\n\nexport default {\n  name: \"SettingPage\",\n  components: {\n    SettingLayout,\n    BaseInput,\n    BaseButton,\n  },\n  data() {\n    return {\n      formItems: [\n        {\n          id: 0,\n          name: \"帳號\",\n          inputName: \"account\",\n          value: \"\",\n          isError: false,\n          isBlank: false,\n          prefix: \"@\",\n        },\n        {\n          id: 1,\n          name: \"名稱\",\n          inputName: \"name\",\n          value: \"\",\n          isError: false,\n        },\n        {\n          id: 2,\n          name: \"Email\",\n          inputName: \"email\",\n          value: \"\",\n          isError: false,\n        },\n        {\n          id: 3,\n          name: \"密碼\",\n          inputName: \"password\",\n          type: \"password\",\n          value: \"\",\n          isError: false,\n          isBlank: false,\n        },\n        {\n          id: 4,\n          name: \"密碼確認\",\n          inputName: \"passwordCheck\",\n          type: \"password\",\n          value: \"\",\n          isError: false,\n          isBlank: false,\n        },\n      ],\n      isAuthenticated: false,\n      isProcessing: false,\n    };\n  },\n  computed: {\n    ...mapState([\"currentUser\"]),\n  },\n  created() {\n    this.setUser();\n  },\n  methods: {\n    // 處理名稱超過50個字的函式\n    handleOverLength() {\n      this.formItems[1].isError = true;\n    },\n    // 將currentUser的資料放入input中的函式\n    setUser() {\n        this.isAuthenticated = true;\n\n        this.formItems[0].value = this.currentUser.account;\n        this.formItems[1].value = this.currentUser.name;\n        this.formItems[2].value = this.currentUser.email;\n    },\n    // 透過伺服器更新個人資訊的函式\n    async updateUserInfo(e) {\n      try {\n        this.isProcessing = true;\n        const id = this.currentUser.id;\n        const account = this.formItems[0];\n        const name = this.formItems[1];\n        const email = this.formItems[2];\n        const password = this.formItems[3];\n        const passwordCheck = this.formItems[4];\n        // const formData = new FormData();\n\n        // 當帳號是空白的提示訊息\n        if (account.value.length < 1) {\n          account.isBlank = true\n          return\n        } else {\n          // 將提示訊息還原\n          account.isBlank = false\n        }\n\n        // 當密碼輸入不相同時\n        if (password.value !== passwordCheck.value) {\n          password.isError = true;\n          passwordCheck.isError = true;\n          return;\n        } else {\n          // 將提示訊息還原\n          password.isError = false;\n          passwordCheck.isError = false;\n        }\n\n        // 當名稱字數超過50個時，無法送出表單\n        if (name.value.length > 50) return;\n\n        // 將form放入formData中並加入introduction\n        const form = e.target\n        const formData = new FormData(form)\n        formData.append(\"introduction\", this.currentUser.introduction);\n\n        // 向API傳送更新的資訊\n        const { data } = await userAPI.update({\n          userId: id,\n          formData,\n        });\n\n        // 當帳號重覆時\n        if (\n          data.status === \"error\" &&\n          data.message === \"Account should be unique.\"\n        ) {\n          console.log(data.message);\n          account.isError = true;\n          return;\n        } else if (\n          data.status === \"error\" &&\n          data.message === \"Email should be unique.\"\n        ) {\n          // 當email重覆時\n          console.log(data.message);\n          email.isError = true;\n          return;\n        } else {\n          // 更新成功時的訊息\n          toast.fireSuccess(\"更新成功\");\n          this.$router.push(\"/main\");\n        }\n      } catch (error) {\n        console.log(\"Error\", error);\n        toast.fireError(\"目前無法修改設定，請稍後再試\");\n      } finally {\n        this.isProcessing = false;\n      }\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.setting-container {\n  margin: 1rem;\n  > .setting-link > .setting-button {\n    color: var(--white-text-color);\n    width: 5rem;\n    height: 100%;\n    padding: 0.5rem 0;\n  }\n}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SettingPage.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SettingPage.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./SettingPage.vue?vue&type=template&id=738abde0&scoped=true&\"\nimport script from \"./SettingPage.vue?vue&type=script&lang=js&\"\nexport * from \"./SettingPage.vue?vue&type=script&lang=js&\"\nimport style0 from \"./SettingPage.vue?vue&type=style&index=0&id=738abde0&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"738abde0\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}